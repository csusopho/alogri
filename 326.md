[Problem: 326. 3 的幂](https://leetcode.cn/problems/power-of-three/description/)

### 方法：位运算 & 数学

一道相似题：[2 的幂](https://leetcode.cn/problems/power-of-two/description/)，题解为 [传送门](https://leetcode.cn/problems/power-of-two/solutions/3747419/qi-jie-mo-ni-di-gui-diao-ku-wei-yun-suan-rotf/)，里面介绍了七种解法，这里同理介绍。

**注意**：所有 $3^x$ 一定大于 $0$，小于等于 $0$ 的数字肯定不符合要求。

题目不允许循环/递归，但是为了防止小白不太清楚，这里仅作展示，代码如下：

```Python
# python
class Solution:
    def isPowerOfThree(self, n: int) -> bool:
        # 小于等于0肯定不符合
        if n <= 0:
            return False
        while n % 3 == 0:
            n //= 3
        # 最终变为 3^0
        return n == 1
```

```Java
// java
class Solution {
    public boolean isPowerOfThree(int n) {
        // 小于等于 0 肯定不符合
        if (n <= 0) {
            return false;
        }
        while (n % 3 == 0) {
            n /= 3;
        }
        // 最终应变为 3^0
        return n == 1;
    }
}
```

```Python
# python
class Solution:
    def isPowerOfThree(self, n: int) -> bool:
        # 递归出口
        if n == 1:
            return True
        if n <= 0 or n % 3 != 0:
            return False
        # 递归调用
        return self.isPowerOfThree(n // 3)
```

```Java
// java
class Solution {
    public boolean isPowerOfThree(int n) {
        // 递归出口
        if (n == 1) {
            return true;
        }
        if (n <= 0 || n % 3 != 0) {
            return false;
        }
        // 递归调用
        return isPowerOfThree(n / 3);
    }
}
```

根据计算机的精度问题，可以直接暴力将数字 **取对数**，判断结果是整数还是小数：

```Python
# python
class Solution:
    def isPowerOfThree(self, n: int) -> bool:
        return n > 0 and log(n, 3) == int(log(n, 3))
```

```Java
// java
class Solution {
    public boolean isPowerOfThree(int n) {
        return n > 0 && Math.log(n) / Math.log(3) == (int)(Math.log(n) / Math.log(3));
    }
}
```

浮点数是 “有限二进制” 表示，很多十进制数不能精确表示。如果你担心 $log$ 函数引入微小的舍入误差，下面提供更精确的写法：

```Python
# python
class Solution:
    def isPowerOfThree(self, n: int) -> bool:
        if n <= 0:
            return False
        log_val = math.log(n, 3)
        return math.isclose(log_val, round(log_val), rel_tol=1e-9)
```

```Java
// java
class Solution {
    public boolean isPowerOfThree(int n) {
        if (n <= 0) return false;
        double logVal = Math.log(n) / Math.log(3);
        return Math.abs(logVal - Math.round(logVal)) < 1e-9; // 容差判断
    }
}
```

- 时间复杂度： $O(logn)$，其中 $n$ 为题目给定数字，位运算
- 空间复杂度： $O(1)$，仅使用常数个额外变量

---

### 打表

题目限制 $n\leq2^{31}-1$，对应 `2,147,483,647`，小于它的 $3$ 次幂全部列举出来，然后一一判断是否等于 $n$。代码如下：

```Python
# python
class Solution:
    def isPowerOfThree(self, n: int) -> bool:
        powers = [
            1, 3, 9, 27, 81, 243, 729, 2187, 6561,
            19683, 59049, 177147, 531441, 1594323,
            4782969, 14348907, 43046721, 129140163,
            387420489, 1162261467]
        return n in powers
```

```Java
// java
class Solution {
    public boolean isPowerOfThree(int n) {
        int[] powers = {1,3,9,27,81,243,729,2187,6561,19683,
                        59049,177147,531441,1594323,4782969,
                        14348907,43046721,129140163,387420489,
                        1162261467};
        for (int p : powers)
            if (n == p) return true;
        return false;
    }
}
```

小于 $n$ 的最大 $3$ 次幂为 $3^{19}$，对应 `1,162,261,467`。小数 $3$ 能整除大数 $9$，根据这种数学关系，能整出一种花活：

```Python
# python
class Solution:
    def isPowerOfThree(self, n: int) -> bool:
        return n > 0 and not 1162261467 % n
```

```Java
// java
class Solution {
    public boolean isPowerOfThree(int n) {
        return n > 0 && 1162261467 % n == 0;
    }
}
```

- 时间复杂度： $O(1)$
- 空间复杂度： $O(1)$

如果本篇题解你觉得写得不错，欢迎点个赞让更多人看见~

> 题解已发布力扣平台 [我的题解](https://leetcode.cn/problems/power-of-three/solutions/3751511/liu-jie-xun-huan-di-gui-qu-dui-shu-da-bi-o6p7/)
