[Problem: 1518. 换水问题](https://leetcode.cn/problems/water-bottles/description/)

### 方法：模拟 & 数学

喝水流程：

- 喝掉有水的瓶子，得到空瓶，累加空瓶数；
- 每次能得到的新水瓶 = 空瓶数 / 交换数。

交替循环上述过程，代码如下，已附加注释：

```Python
# python
class Solution:
    def numWaterBottles(self, numBottles: int, numExchange: int) -> int:
        # 初始时，喝掉所有购买的水
        drank = numBottles
        empty = numBottles
        
        # 空瓶数量足够兑换时
        while empty >= numExchange:
            # 计算可以兑换的新水瓶数量
            exchanged = empty // numExchange
            # 喝掉新换来的水
            drank += exchanged
            # 计算剩余的空瓶数量
            remaining = empty % numExchange
            # 更新总的空瓶数量：新喝完的瓶子 + 之前剩下的瓶子
            empty = exchanged + remaining
            
        return drank
```

```Java
// java
class Solution {
    public int numWaterBottles(int numBottles, int numExchange) {
        // 初始时，喝掉所有购买的水
        int drank = numBottles;
        int empty = numBottles;
        
        // 空瓶数量足够兑换时
        while (empty >= numExchange) {
            // 计算可以兑换的新水瓶数量
            int exchanged = empty / numExchange;
            // 喝掉新换来的水
            drank += exchanged;
            // 计算剩余的空瓶数量
            int remaining = empty % numExchange;
            // 更新总的空瓶数量：新喝完的瓶子 + 之前剩下的瓶子
            empty = exchanged + remaining;
        }
            
        return drank;
    }
}
```

- 时间复杂度： $O(log_E{B})$，其中 $B,E$ 分别为两变量的缩写
- 空间复杂度： $O(1)$，仅使用常数个额外变量

---

### 数学

每当我们进行一次兑换：

- **付出**：`numExchange` 个空瓶子。
- **得到**：一瓶满水，喝完后会变成 $1$ 个空瓶子。

因此，在每一次成功的兑換后，手上的空瓶子数量净减少了 `numExchange - 1` 个。

也就是说，最终能额外获得多少瓶水，取决于我们最初的 `numBottles` 个空瓶，能够支持我们进行多少次这样的 **“净减少”** 操作。

1. 总“资本”：喝完最初的 `numBottles` 瓶水后，我们拥有 `numBottles` 个空瓶作为启动 “资本” 来进行兑换。

2. 每次兑换的净成本：如上所述，每换一瓶新水，我们最终会永久性地失去 `numExchange - 1` 个空瓶。

3. 计算可兑换的总数：那么，用我们全部的 “资本” `numBottles` 个空瓶，最多能承担多少次净成本为 `numExchange - 1` 的兑换呢？

注意，我们不能直接用 `numBottles // (numExchange - 1)`，因为这些空瓶子并不能全部被 “消耗” 掉。最后，无论如何也凑不够 `numExchange` 个空瓶时，手上必然会剩下至少 `1` 个空瓶，所以我们实际可用于循环兑换的资本是 `numBottles - 1`。

因此，可以兑换到的新水瓶数量是 `(numBottles - 1) // (numExchange - 1)`。

加上一开始的水瓶，总共能喝的水是

$$
numBottles + (numBottles - 1) / (numExchange - 1)
$$

代码如下，已附加注释：

```Python
# python
class Solution:
    def numWaterBottles(self, numBottles: int, numExchange: int) -> int:
        # 额外可以喝到的瓶子数
        exchanged_bottles = (numBottles - 1) // (numExchange - 1)
        # 总数 = 初始瓶子数 + 额外兑换的瓶子数
        return numBottles + exchanged_bottles
```

```Java
// java
class Solution {
    public int numWaterBottles(int numBottles, int numExchange) {
        // 额外可以喝到的瓶子数
        int exchanged_bottles = (numBottles - 1) / (numExchange - 1);
        // 总数 = 初始瓶子数 + 额外兑换的瓶子数
        return numBottles + exchanged_bottles;
    }
}
```

- 时间复杂度： $O(1)$，数学计算
- 空间复杂度： $O(1)$

如果本篇题解你觉得写得不错，欢迎点个赞让更多人看见~

> 题解已发布力扣平台 [我的题解](https://leetcode.cn/problems/water-bottles/solutions/3796246/shuang-jie-xun-huan-mo-ni-shu-xue-ji-sua-z1us/)
